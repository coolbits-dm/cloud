# CoolBits.ai Monitoring Policies Configuration
# ============================================

# P95 Latency Policy
{
  "displayName": "CoolBits P95 Latency > 400ms",
  "conditions": [
    {
      "displayName": "Frontend P95 Latency",
      "conditionThreshold": {
        "filter": "metric.type=\"run.googleapis.com/request_latencies\" AND resource.label.\"service_name\"=\"coolbits-frontend\"",
        "comparison": "COMPARISON_GT",
        "thresholdValue": 0.4,
        "duration": "300s",
        "aggregations": [
          {
            "alignmentPeriod": "60s",
            "perSeriesAligner": "ALIGN_DELTA",
            "crossSeriesReducer": "REDUCE_PERCENTILE_95",
            "groupByFields": ["resource.label.service_name"]
          }
        ]
      }
    }
  ],
  "notificationChannels": ["projects/coolbits-og-bridge/notificationChannels/CHANNEL_ID"],
  "alertStrategy": {
    "autoClose": "1800s"
  }
}

# 5xx Rate Policy
{
  "displayName": "CoolBits 5xx Rate > 1%",
  "conditions": [
    {
      "displayName": "Frontend 5xx Rate",
      "conditionThreshold": {
        "filter": "metric.type=\"run.googleapis.com/request_count\" AND metric.label.\"response_code_class\"=\"5xx\" AND resource.label.\"service_name\"=\"coolbits-frontend\"",
        "comparison": "COMPARISON_GT",
        "thresholdValue": 0.01,
        "duration": "300s",
        "aggregations": [
          {
            "alignmentPeriod": "60s",
            "perSeriesAligner": "ALIGN_RATE",
            "crossSeriesReducer": "REDUCE_SUM",
            "groupByFields": ["resource.label.service_name"]
          }
        ]
      }
    }
  ],
  "notificationChannels": ["projects/coolbits-og-bridge/notificationChannels/CHANNEL_ID"],
  "alertStrategy": {
    "autoClose": "1800s"
  }
}

# CPU Usage Policy
{
  "displayName": "CoolBits CPU Usage > 80%",
  "conditions": [
    {
      "displayName": "High CPU Usage",
      "conditionThreshold": {
        "filter": "metric.type=\"run.googleapis.com/container/cpu/utilizations\" AND resource.label.\"service_name\"=\"coolbits-frontend\"",
        "comparison": "COMPARISON_GT",
        "thresholdValue": 0.8,
        "duration": "300s",
        "aggregations": [
          {
            "alignmentPeriod": "60s",
            "perSeriesAligner": "ALIGN_MEAN",
            "crossSeriesReducer": "REDUCE_MEAN",
            "groupByFields": ["resource.label.service_name"]
          }
        ]
      }
    }
  ],
  "notificationChannels": ["projects/coolbits-og-bridge/notificationChannels/CHANNEL_ID"],
  "alertStrategy": {
    "autoClose": "1800s"
  }
}

# Memory Usage Policy
{
  "displayName": "CoolBits Memory Usage > 80%",
  "conditions": [
    {
      "displayName": "High Memory Usage",
      "conditionThreshold": {
        "filter": "metric.type=\"run.googleapis.com/container/memory/utilizations\" AND resource.label.\"service_name\"=\"coolbits-frontend\"",
        "comparison": "COMPARISON_GT",
        "thresholdValue": 0.8,
        "duration": "300s",
        "aggregations": [
          {
            "alignmentPeriod": "60s",
            "perSeriesAligner": "ALIGN_MEAN",
            "crossSeriesReducer": "REDUCE_MEAN",
            "groupByFields": ["resource.label.service_name"]
          }
        ]
      }
    }
  ],
  "notificationChannels": ["projects/coolbits-og-bridge/notificationChannels/CHANNEL_ID"],
  "alertStrategy": {
    "autoClose": "1800s"
  }
}

# Uptime Check Failure Policy
{
  "displayName": "CoolBits Uptime Check Failure",
  "conditions": [
    {
      "displayName": "Uptime Check Down",
      "conditionThreshold": {
        "filter": "metric.type=\"monitoring.googleapis.com/uptime_check/check_passed\" AND resource.label.\"check_id\"=~\"coolbits-.*\"",
        "comparison": "COMPARISON_FALSE",
        "thresholdValue": 0,
        "duration": "60s",
        "aggregations": [
          {
            "alignmentPeriod": "60s",
            "perSeriesAligner": "ALIGN_MEAN",
            "crossSeriesReducer": "REDUCE_MEAN",
            "groupByFields": ["resource.label.check_id"]
          }
        ]
      }
    }
  ],
  "notificationChannels": ["projects/coolbits-og-bridge/notificationChannels/CHANNEL_ID"],
  "alertStrategy": {
    "autoClose": "1800s"
  }
}
